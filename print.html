<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>godot-luau-script Documentation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Usage</li><li class="chapter-item expanded "><a href="usage/building-and-installation.html"><strong aria-hidden="true">1.</strong> Building and Installation</a></li><li class="chapter-item expanded "><a href="usage/accessing-godot.html"><strong aria-hidden="true">2.</strong> Accessing Godot APIs</a></li><li class="chapter-item expanded "><a href="usage/class-registration/index.html"><strong aria-hidden="true">3.</strong> Class Registration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="usage/class-registration/annotations.html"><strong aria-hidden="true">3.1.</strong> Annotations</a></li><li class="chapter-item expanded "><a href="usage/class-registration/defining-a-class.html"><strong aria-hidden="true">3.2.</strong> Defining a Class</a></li><li class="chapter-item expanded "><a href="usage/class-registration/annotation-reference/index.html"><strong aria-hidden="true">3.3.</strong> Annotation Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="usage/class-registration/annotation-reference/class-definition.html"><strong aria-hidden="true">3.3.1.</strong> Class Definition</a></li><li class="chapter-item expanded "><a href="usage/class-registration/annotation-reference/class-type.html"><strong aria-hidden="true">3.3.2.</strong> Class Type</a></li><li class="chapter-item expanded "><a href="usage/class-registration/annotation-reference/methods.html"><strong aria-hidden="true">3.3.3.</strong> Methods</a></li><li class="chapter-item expanded "><a href="usage/class-registration/annotation-reference/assigns.html"><strong aria-hidden="true">3.3.4.</strong> Assigns</a></li></ol></li><li class="chapter-item expanded "><a href="usage/class-registration/type-conversion.html"><strong aria-hidden="true">3.4.</strong> Type Conversion</a></li><li class="chapter-item expanded "><a href="usage/class-registration/virtual-methods.html"><strong aria-hidden="true">3.5.</strong> Virtual Methods</a></li><li class="chapter-item expanded "><a href="usage/class-registration/idiomatic-class.html"><strong aria-hidden="true">3.6.</strong> The "Idiomatic" Class</a></li></ol></li><li class="chapter-item expanded "><a href="usage/luau-script-api.html"><strong aria-hidden="true">4.</strong> godot-luau-script API Reference</a></li><li class="chapter-item expanded "><a href="usage/core-scripts-vms-permissions.html"><strong aria-hidden="true">5.</strong> "Core Scripts", VMs, and Permissions</a></li><li class="chapter-item expanded "><a href="usage/modules.html"><strong aria-hidden="true">6.</strong> Modules</a></li><li class="chapter-item expanded "><a href="usage/task-scheduler.html"><strong aria-hidden="true">7.</strong> The Task Scheduler</a></li><li class="chapter-item expanded "><a href="usage/init-file.html"><strong aria-hidden="true">8.</strong> init.lua</a></li><li class="chapter-item expanded "><a href="usage/typechecking-autocomplete.html"><strong aria-hidden="true">9.</strong> Typechecking and Autocomplete</a></li><li class="chapter-item expanded "><a href="usage/known-issues.html"><strong aria-hidden="true">10.</strong> Known Issues</a></li><li class="chapter-item expanded affix "><li class="part-title">Development</li><li class="chapter-item expanded "><a href="development/tests.html"><strong aria-hidden="true">11.</strong> Tests</a></li><li class="chapter-item expanded "><a href="development/debugging.html"><strong aria-hidden="true">12.</strong> Debugging</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">godot-luau-script Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><code>godot-luau-script</code> is a GDExtension adding support for Roblox’s
<a href="https://luau-lang.org/">Luau</a>, a variant of Lua 5.1, to Godot 4.x as a
scripting language.</p>
<h2 id="priorities"><a class="header" href="#priorities">Priorities</a></h2>
<p>This project has a few specific goals:</p>
<ul>
<li>Parity with Godot’s official scripting languages (GDScript, C#)</li>
<li>Allow for (relatively) safe loading of user-generated content (UGC) including
scripts
<ul>
<li>Sandbox “core” and “user” scripts from each other (separate Lua VMs)</li>
<li>Enforce permission levels for restricted APIs, such as networking or
filesystem access</li>
<li>Limit breakage of the game by user scripts</li>
<li>Scan PCKs for unsafe script or resource access</li>
</ul>
</li>
<li>Support typechecking of source files</li>
</ul>
<p>Note that <code>godot-luau-script</code> was specifically built for loading untrusted UGC.
As such, other languages like GDScript may be more suitable if UGC support is
not needed (that is, unless you are partial to Luau as a language).</p>
<h2 id="disclaimer"><a class="header" href="#disclaimer">Disclaimer</a></h2>
<p>This project is still in relatively early stages. Please keep in mind:</p>
<ul>
<li><strong>(Potentially major) breaking changes will happen often and whenever
necessary.</strong></li>
<li>This project will usually track the latest Godot version (including preview
releases), and support for older versions is not planned.</li>
<li>This documentation may be incomplete or out-of-date. Please <a href="https://github.com/Fumohouse/godot-luau-script/issues/new/choose">report an issue</a>
if this is the case.</li>
<li>Some security issues may remain. Please report an issue if you encounter one.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-and-installation"><a class="header" href="#building-and-installation">Building and Installation</a></h1>
<h2 id="download"><a class="header" href="#download">Download</a></h2>
<p>Prebuilt binaries for each tagged release can be found on the <a href="https://codeberg.org/ksk/godot-luau-script/releases">releases page</a>.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p>All necessary GDExtension files are provided in <code>bin/</code>. It should suffice to
copy the entire folder into your Godot project. After reloading the project, the
extension should be loaded and you should be able to create a Luau script
through the script creation dialog.</p>
<h2 id="building-yourself"><a class="header" href="#building-yourself">Building yourself</a></h2>
<p><code>godot-luau-script</code> uses <a href="https://scons.org/">SConstruct</a> to build.</p>
<h3 id="cloning"><a class="header" href="#cloning">Cloning</a></h3>
<p>The three dependencies this project has, godot-cpp, Luau, and Catch2, are added
as submodules in <code>extern/</code>. As such, make sure to clone submodules when cloning
this project:</p>
<ul>
<li><code>git clone https://github.com/Fumohouse/godot-luau-script --recurse-submodules</code>, or</li>
<li><code>git submodule update --recursive</code> if the repository is already cloned.</li>
</ul>
<h3 id="supported-platforms"><a class="header" href="#supported-platforms">Supported platforms</a></h3>
<p><code>godot-luau-script</code> supports compilation using recent versions of Clang, GCC,
MinGW, and MSVC, and building for Windows, macOS, and Linux. LLVM (<code>clang++</code>,
<code>clangd</code>, <code>clang-format</code>) utilities are preferred where possible.</p>
<h3 id="building"><a class="header" href="#building">Building</a></h3>
<p>Ensure that a supported toolchain is installed. You will also need to install
<a href="https://www.python.org/">Python 3</a> and run <code>python -m pip install scons</code> to
install SConstruct. If on Linux, SConstruct is also available through some
package repositories.</p>
<p>If you are running a Python version older than 3.11, you will need to
<code>python -m pip install tomli</code> for TOML support.</p>
<p>Build the project by running <code>scons</code> at the project root. The following flags
are supported:</p>
<ul>
<li><code>tests=yes</code>: Build with <a href="usage/../development/tests.html">Catch2 tests</a> included.</li>
<li><code>iwyu=yes</code>: Run <a href="https://github.com/include-what-you-use/include-what-you-use"><code>include-what-you-use</code></a>
instead of the compiler to find potential <code>#include</code> mistakes.</li>
<li><code>generate_luau_bindings=yes</code>: Force regeneration of any auto-generated files
(see <code>bindgen/</code>).</li>
</ul>
<p>Additionally, you may want to use the following flags from godot-cpp:</p>
<ul>
<li><code>target=editor</code>: Build for the editor.</li>
<li><code>target=template_release</code>: Build for release templates.</li>
<li><code>use_llvm=yes</code>: Force usage of LLVM for compilation (over GCC).</li>
<li><code>debug_symbols=yes</code>: Build the project with debug symbols.</li>
<li>Run <code>scons compiledb target=editor tests=yes</code> to generate a compilation
commands database, typically for use with a language server like <code>clangd</code>.</li>
</ul>
<p>After building, the output will be present in the <code>bin/</code> folder.</p>
<h2 id="build-containers"><a class="header" href="#build-containers">Build containers</a></h2>
<p><code>podman</code> build containers are provided in <code>build_containers/</code> for reproducible
build environments targeting Linux, Windows, and macOS.</p>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<p>Scripts should not be run outside the directory they are in.</p>
<ol>
<li>Ensure <code>podman</code> is installed</li>
<li>Build images with <code>build_images.sh</code></li>
<li>Build the project with <code>build_gls.sh</code> - use arguments <code>linux</code>, <code>windows</code>, and
<code>macos</code> to select which platform(s) to build</li>
</ol>
<h3 id="preparing-osxcross"><a class="header" href="#preparing-osxcross">Preparing <code>osxcross</code></a></h3>
<p>Go to <a href="https://github.com/tpoechtrager/osxcross/tree/master">tpoechtrager/osxcross</a>
and follow an appropriate procedure for downloading Xcode and packaging the SDK
on your system.</p>
<p>Place the output SDK (expected name: <code>MacOSX13.3.sdk.tar.xz</code>) in
<code>build_containers/files/</code>.</p>
<p>Build was tested on Xcode 14.3.1 (SDK: macOS 13.3).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="accessing-godot-apis"><a class="header" href="#accessing-godot-apis">Accessing Godot APIs</a></h1>
<p>The majority of builtin and <code>Object</code> classes are bound from Godot to Luau. A
selection of utility functions from Godot are also available.</p>
<p>To find out what APIs are exposed, you can refer to the
<code>definitions/luauScriptTypes.gen.d.lua</code> file after building (beware: this file
is large!) or rely on <a href="usage/./typechecking-autocomplete.html">autocomplete</a> to tell
you.</p>
<p>For the most part, you can refer to <a href="https://docs.godotengine.org/en/latest/">Godot’s documentation</a>
to discover the API. After learning the rules below, this should become
relatively intuitive.</p>
<h2 id="renaming-rules"><a class="header" href="#renaming-rules">Renaming rules</a></h2>
<p>Most names are adapted from their Godot counterparts according to the following
convention:</p>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>Godot Case</th><th>Luau Case</th></tr></thead><tbody>
<tr><td>Classes and enums</td><td><code>PascalCase</code></td><td><em>unchanged</em></td></tr>
<tr><td>Utility functions</td><td><code>snake_case</code></td><td><em>unchanged with few exceptions</em></td></tr>
<tr><td>Enum values</td><td><code>PREFIX_UPPER_SNAKE_CASE</code></td><td><code>UPPER_SNAKE_CASE</code> <em>with exceptions</em> *</td></tr>
<tr><td>Constants</td><td><code>UPPER_SNAKE_CASE</code></td><td><em>unchanged</em></td></tr>
<tr><td>Methods</td><td><code>snake_case</code></td><td><code>PascalCase</code></td></tr>
<tr><td>Properties/signals</td><td><code>snake_case</code></td><td><code>camelCase</code></td></tr>
</tbody></table>
</div>
<p>*: e.g. for the <code>PropertyUsage</code> enum, the prefix on all values is
<code>PROPERTY_USAGE_</code>; this is removed. Additionally, if an enum name begins with a
number after renaming (e.g. <code>KEY_9</code> with prefix <code>KEY_</code> -&gt; <code>9</code>), an <code>N</code> will be
prepended to the name -&gt; <code>N9</code>.</p>
<h2 id="accessible-apis"><a class="header" href="#accessible-apis">Accessible APIs</a></h2>
<h3 id="globals"><a class="header" href="#globals">Globals</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>Godot Access</th><th>Luau Access</th><th>GDScript Example</th><th>Luau Example</th></tr></thead><tbody>
<tr><td>Global enum</td><td><code>@GlobalScope</code></td><td><code>Enum.</code> namespace</td><td><code>MARGIN_LEFT</code></td><td><code>Enum.Margin.LEFT</code></td></tr>
<tr><td>Global constant</td><td><code>@GlobalScope</code></td><td><code>Constants.</code> namespace</td><td><em>N/A</em></td><td><em>N/A</em></td></tr>
<tr><td>Utility function</td><td><code>@GlobalScope</code></td><td><code>_G</code></td><td><code>lerpf(0.0, 1.0, 0.5)</code></td><td><code>lerp(0, 1, 0.5)</code> *</td></tr>
</tbody></table>
</div>
<p>*: This is one of the renamed functions mentioned above.</p>
<h3 id="variant-and-object-classes"><a class="header" href="#variant-and-object-classes">Variant and Object classes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>Godot Access</th><th>Luau Access</th><th>GDScript Example</th><th>Luau Example</th></tr></thead><tbody>
<tr><td>Variant constructors</td><td><code>&lt;ClassName&gt;</code></td><td><code>&lt;ClassName&gt;.new()</code></td><td><code>Vector3(0, 1, 0)</code></td><td><code>Vector3.new(0, 1, 0)</code></td></tr>
<tr><td>Object constructors</td><td><code>&lt;ClassName&gt;.new()</code></td><td><em>unchanged</em></td><td><code>AESContext.new()</code></td><td><em>unchanged</em></td></tr>
<tr><td>Object singleton</td><td><code>&lt;ClassName&gt;</code></td><td><code>&lt;ClassName&gt;.singleton</code></td><td></td><td></td></tr>
<tr><td>Static methods</td><td><code>&lt;ClassName&gt;.&lt;Method&gt;</code></td><td><em>unchanged</em></td><td><code>Vector2.from_angle(x)</code></td><td><code>Vector2.FromAngle(x)</code></td></tr>
<tr><td>Instance methods</td><td><code>&lt;Instance&gt;.&lt;Method&gt;</code></td><td><code>&lt;Instance&gt;:&lt;Method&gt;</code></td><td><code>v1.dot(v2)</code></td><td><code>v1:Dot(v2)</code></td></tr>
<tr><td>Member/property/signal access</td><td><code>&lt;Instance&gt;.&lt;Property&gt;</code></td><td><em>unchanged</em> *</td><td><code>vector.x</code></td><td><em>unchanged</em></td></tr>
<tr><td>Keyed/indexed set</td><td><code>&lt;Instance&gt;[&lt;Key&gt;] = &lt;Value&gt;</code></td><td><code>&lt;Instance&gt;:Set(&lt;Key&gt;, &lt;Value&gt;)</code></td><td><code>dictionary[&quot;key&quot;] = 1</code></td><td><code>dictionary:Set(&quot;key&quot;, 1)</code></td></tr>
<tr><td>Keyed/indexed get</td><td><code>&lt;Instance&gt;[&lt;Key&gt;]</code></td><td><code>&lt;Instance&gt;:Get(&lt;Key&gt;)</code></td><td><code>dictionary[&quot;key&quot;]</code></td><td><code>dictionary:Get(&quot;key&quot;)</code></td></tr>
<tr><td>Array length</td><td><code>&lt;Array&gt;.size()</code></td><td><code>&lt;Array&gt;:Size()</code> OR <code>#&lt;Array&gt;</code></td><td><code>array.size()</code></td><td><code>array:Size()</code> OR <code>#array</code></td></tr>
<tr><td>Array iteration</td><td><code>for item in &lt;Array&gt;:</code></td><td><code>for index, item in &lt;Array&gt; do</code> **</td><td></td><td></td></tr>
<tr><td>Dictionary iteration</td><td><code>for key in &lt;Dictionary&gt;:</code></td><td><code>for key, value in &lt;Dictionary&gt; do</code> **</td><td></td><td></td></tr>
<tr><td>Variant type operators</td><td><code>&lt;A&gt; &lt;Op&gt; &lt;B&gt;</code>/<code>&lt;Unary&gt;&lt;A&gt;</code></td><td><em>unchanged</em> ***</td><td><code>v1 == v2</code></td><td><em>unchanged</em></td></tr>
<tr><td>Variant/Object to string</td><td><code>str(&lt;Instance&gt;)</code></td><td><code>tostring(&lt;Instance&gt;)</code></td><td></td><td></td></tr>
</tbody></table>
</div>
<p>*: Variant type properties (e.g. <code>Vector2.x</code>) <strong>cannot be set</strong> because Luau
does not support copy on assign (as C++ and GDScript do). You must construct a
new object instead. <br />
**: Iterators do not support modification during iteration. Doing so may cause
errors or for items to be skipped. <br />
***: Some Godot operators are not supported as they do not exist in Luau. Also,
<code>==</code> comparison is not allowed between two different types in Luau, so these
operators do not work.</p>
<h3 id="notes"><a class="header" href="#notes">Notes</a></h3>
<ul>
<li>For security reasons, the only supported <code>Callable</code> constructor is
<code>Callable.new(object: Object, methodName: string | StringName)</code>.</li>
<li><code>String</code>, <code>StringName</code>, and <code>NodePath</code> are not bound to Luau as Luau’s builtin
<code>string</code> suffices in the majority of cases. <code>StringName</code> and <code>NodePath</code> can be
constructed manually if needed (e.g. if a <code>String</code> type would be inferred over
the other two types) by using the <code>SN</code> or <code>NP</code> global functions respectively.
<ul>
<li>The intention with these constructors is to use them like a prefix you would
find in other languages, e.g. <code>SN&quot;testStringName&quot;</code>. This is valid because
of Lua’s parsing rules.</li>
</ul>
</li>
<li>Some Lua types are automatically converted to Godot types when necessary:
<ul>
<li><code>{Variant}</code> to <code>Array</code></li>
<li><code>{T}</code> to their corresponding <code>Packed[T]Array</code> types</li>
<li><code>{[Variant]: Variant}</code> to <code>Dictionary</code></li>
<li><code>string</code> to <code>String</code>, <code>NodePath</code>, or <code>StringName</code></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="class-registration"><a class="header" href="#class-registration">Class Registration</a></h1>
<p>Class registration allows creating custom script classes derived from Godot
classes or other script classes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="annotations"><a class="header" href="#annotations">Annotations</a></h1>
<p>Class registration in <code>godot-luau-script</code> is primarily done through annotations,
an extension of Luau’s syntax expressed with comments.</p>
<p>Annotation comments begin with three dashes in a row, and must have no code on
the same line. A block of annotation comments is delimited by a completely blank
line, and the code the annotation refers to is on the line after the last
comment line.</p>
<p>Annotations begin with an <code>@</code> followed by a <code>camelCase</code> name.  Where there are
multiple arguments, they are separated by spaces.</p>
<p>An optional text comment can precede the annotation comments. This comment is
currently parsed but not used for anything.</p>
<pre><code class="language-lua">--- This is a comment. Documentation can go here.
---
--- The empty comment above indicates a line break.
--- @annotation1 arg1 arg2 arg3
--- @annotation2 arg1 arg2 arg3
local x = 1 -- The above comment block is attached to this line.

--- This is a comment.

--- This is a different comment since the above line is empty.

-- This is not an annotation comment.

--[[
    This is not an annotation comment.
]]

print(&quot;hello world!&quot;) --- This is not an annotation comment.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defining-a-class"><a class="header" href="#defining-a-class">Defining a Class</a></h1>
<p><code>godot-luau-script</code> classes are essentially a special table created using
<code>gdclass</code>.</p>
<p>Both the original table and the output of <code>gdclass</code> are expected to be stored
in locals, typically at the start of the file.</p>
<p>Annotations used for class registration, such as <code>@class</code>, should be placed
on the original table local and not the local storing the output of <code>gdclass</code>.</p>
<p>The output of <code>gdclass</code> should be returned at the end of the file.</p>
<p>Valid example:</p>
<pre><code class="language-lua">--- @class
local MyClass = {}
local MyClassC = gdclass(MyClass)

return MyClassC
</code></pre>
<p>Invalid example:</p>
<pre><code class="language-lua">--- @class
MyClass = {} -- INVALID: The class parser ignores globals

return gdclass(MyClass) -- INVALID: The class parser will not trace this return
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="annotation-reference"><a class="header" href="#annotation-reference">Annotation Reference</a></h1>
<p>Key for documentation:</p>
<ul>
<li><code>[]</code> denotes an optional argument</li>
<li><code>&lt;&gt;</code> denotes a required argument</li>
<li><code>...</code> means an argument can be supplied multiple times</li>
<li><code>|</code> means ‘or’</li>
<li><code>''</code> denotes a literal argument supplied to the annotation without quotes</li>
<li><code>{}</code> denotes multiple choices at any given location</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="class-definition"><a class="header" href="#class-definition">Class Definition</a></h1>
<p>These annotations should be attached to the local defining the original class
table (in <a href="usage/class-registration/annotation-reference/../defining-a-class.html">this example</a>, <code>MyClass</code>).</p>
<h2 id="class-globalclassname"><a class="header" href="#class-globalclassname"><code>@class [globalClassName]</code></a></h2>
<p>Required to define a class.</p>
<ul>
<li><code>globalClassName</code>: If supplied, the class will be globally visible to Godot.</li>
</ul>
<h2 id="extends-base"><a class="header" href="#extends-base"><code>@extends &lt;base&gt;</code></a></h2>
<p>Defines a script’s base class.</p>
<ul>
<li><code>base</code>: Either a valid Godot class name, or the name of a local containing a
directly <code>require</code>d script.</li>
</ul>
<p><code>require</code> example:</p>
<pre><code class="language-lua">-- Your require call must directly contain a path.
-- It must appear before the @extends annotation.
local BaseClass = require(&quot;BaseClass.lua&quot;)

--- @class
--- @extends BaseClass
local MyClass = {}

-- &lt;truncated&gt;
</code></pre>
<h2 id="tool"><a class="header" href="#tool"><code>@tool</code></a></h2>
<p>Indicates the script is instantiable/runnable in the editor.</p>
<h2 id="permissions-permissionsflags"><a class="header" href="#permissions-permissionsflags"><code>@permissions &lt;...permissionsFlags&gt;</code></a></h2>
<p>Declares the script’s permissions (see <a href="usage/class-registration/annotation-reference/../../core-scripts-vms-permissions.html">“Core Scripts”, VMs, and Permissions</a>).</p>
<ul>
<li><code>permissionsFlags</code>: Valid permissions flags.</li>
</ul>
<p>The following permissions flags are accepted:</p>
<ul>
<li><code>BASE</code>: Used for functionality that is available to all scripts by default.</li>
<li><code>INTERNAL</code>: Used for functionality that is not part of any special permission
level or <code>BASE</code>.</li>
<li><code>OS</code>: Used for the <code>OS</code> singleton.</li>
<li><code>FILE</code>: Used for any filesystem functionality.</li>
<li><code>HTTP</code>: Used for any functionality allowing HTTP listen/requests.</li>
</ul>
<h2 id="iconpath-path"><a class="header" href="#iconpath-path"><code>@iconPath &lt;path&gt;</code></a></h2>
<p>Defines a script’s icon in the editor.</p>
<ul>
<li><code>path</code>: The path to the icon. Must be absolute and point to an SVG image.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="class-type"><a class="header" href="#class-type">Class Type</a></h1>
<h2 id="classtype-classlocal"><a class="header" href="#classtype-classlocal"><code>@classType &lt;classLocal&gt;</code></a></h2>
<p>This annotation should be attached to the type definition associated with your
class.</p>
<p>Links a class to its type definition, which is used for registering properties
and signals.</p>
<ul>
<li><code>classLocal</code>: The name of the local which your <code>@class</code> annotation is
attached to.</li>
</ul>
<p>Example:</p>
<pre><code class="language-lua">--- @class
local MyClass = {}

--- @classType MyClass
export type MyClass = RefCounted &amp; typeof(MyClass) &amp; {
    -- Attach annotations in the &quot;Property annnotations&quot; section here.
    tableField1: number,
    tableField2: string,
} &amp; {
    -- It's okay to intersect multiple table types.
    -- Annotations will still be parsed.
    tableField3: Vector2,
}

-- &lt;truncated&gt;
</code></pre>
<p>Only plain table types and intersections (<code>&amp;</code>, not <code>|</code>) are supported.</p>
<h2 id="property-annotations"><a class="header" href="#property-annotations">Property annotations</a></h2>
<p>These annotations should be attached to the individual properties in your class
type.</p>
<h3 id="property-groups"><a class="header" href="#property-groups">Property groups</a></h3>
<p>These annotations are evaluated in order alongside <code>@property</code> and <code>@signal</code>.</p>
<h4 id="propertygroup-groupname"><a class="header" href="#propertygroup-groupname"><code>@propertyGroup [groupName]</code></a></h4>
<p>Denotes a property group visible in the Godot editor.</p>
<ul>
<li><code>groupName</code>: The group name. If not supplied, the group for the next property
is unset.</li>
</ul>
<h4 id="propertysubgroup-groupname"><a class="header" href="#propertysubgroup-groupname"><code>@propertySubgroup [groupName]</code></a></h4>
<p>Denotes a subgroup of a property group visible in the Godot editor.</p>
<ul>
<li><code>groupName</code>: The group name. If not supplied, the group for the next property
is unset.</li>
</ul>
<h4 id="propertycategory-groupname"><a class="header" href="#propertycategory-groupname"><code>@propertyCategory [groupName]</code></a></h4>
<p>Denotes a property category visible in the Godot editor.</p>
<ul>
<li><code>groupName</code>: The group name. If not supplied, the category for the next
property is unset.</li>
</ul>
<h3 id="properties"><a class="header" href="#properties">Properties</a></h3>
<p>The following annotations apply only to properties.</p>
<h4 id="property"><a class="header" href="#property"><code>@property</code></a></h4>
<p>Indicates a property should be exposed to Godot, registered based on its type
annotation. All additional information necessary for the property is supplied
through other annotations.</p>
<h4 id="default-defaultvalue"><a class="header" href="#default-defaultvalue"><code>@default &lt;defaultValue&gt;</code></a></h4>
<p>Registers a property’s default value, which will be automatically assigned when
a script instance is initialized if no setter or getter exists.</p>
<ul>
<li><code>defaultValue</code>: The default value, in a format compatible with Godot’s
<a href="https://docs.godotengine.org/en/stable/classes/class_@globalscope.html#class-globalscope-method-str-to-var"><code>str_to_var</code></a>.</li>
</ul>
<h4 id="set-method-and-get-method"><a class="header" href="#set-method-and-get-method"><code>@set &lt;method&gt;</code> and <code>@get &lt;method&gt;</code></a></h4>
<p>Register a property’s setter and getter, respectively.</p>
<ul>
<li><code>method</code>: The name of the setter/getter. The method should be part of this
class and registered to Godot.</li>
</ul>
<h4 id="range-min-max-step-orgreaterorlesshidesliderradiansdegreesradiansasdegreesexpsuffixsuffix"><a class="header" href="#range-min-max-step-orgreaterorlesshidesliderradiansdegreesradiansasdegreesexpsuffixsuffix"><code>@range &lt;min&gt; &lt;max&gt; [step] [...'orGreater'|'orLess'|'hideSlider'|'radians'|'degrees'|'radiansAsDegrees'|'exp'|'suffix:'&lt;suffix&gt;]</code></a></h4>
<p>Valid only for <code>integer</code> and <code>number</code> properties. Defines the range (and
optional step) for a numeric value in the Godot editor.</p>
<p>Do not use decimals (including <code>.0</code>) for <code>integer</code> properties.</p>
<ul>
<li><code>min</code>: The minimum value.</li>
<li><code>max</code>: The maximum value.</li>
<li><code>step</code>: The step value.</li>
<li><code>orGreater</code> and <code>orLess</code>: Allow the limit to apply only to the slider.</li>
<li><code>hideSlider</code>: Hide the slider.</li>
<li><code>radians</code> and <code>degrees</code>: Indicate the units of an angle value.</li>
<li><code>radiansAsDegrees</code>: Indicate the value is in radians but should be displayed
as degrees in the editor.</li>
<li><code>exp</code>: Cause values to change exponentially.</li>
<li><code>suffix:&lt;suffix&gt;</code>: Provide a custom suffix for the value.</li>
</ul>
<h4 id="enum-values"><a class="header" href="#enum-values"><code>@enum &lt;...values&gt;</code></a></h4>
<p>Valid only for <code>integer</code> and <code>string</code> properties. Defines a set of acceptable
values for a property in the Godot editor, either by index (for <code>integer</code>
properties) or name (for <code>string</code> properties).</p>
<ul>
<li><code>values</code>: The enum values.</li>
</ul>
<h4 id="suggestion-values"><a class="header" href="#suggestion-values"><code>@suggestion &lt;...values&gt;</code></a></h4>
<p>Valid only for <code>string</code> properties. Defines a set of suggested values for a
property in the Godot editor.</p>
<ul>
<li><code>values</code>: The suggested values.</li>
</ul>
<h4 id="flags-flagvalues"><a class="header" href="#flags-flagvalues"><code>@flags &lt;...flagValues&gt;</code></a></h4>
<p>Valid only for <code>integer</code> properties. Defines a set of bit flags which are easily
set in the Godot editor.</p>
<ul>
<li><code>flagValues</code>: The names of the flag values.</li>
</ul>
<h4 id="file-global-extensions"><a class="header" href="#file-global-extensions"><code>@file ['global'] [...extensions]</code></a></h4>
<p>Valid only for <code>string</code> properties. Indicates to the Godot editor that a string
should be a file path.</p>
<ul>
<li><code>global</code>: If supplied, the path is not constrained to the current Godot
project.</li>
<li><code>extensions</code>: Desired extensions in the format <code>*.ext</code>, for example <code>*.png</code>
and <code>*.jpeg</code>.</li>
</ul>
<h4 id="dir-global"><a class="header" href="#dir-global"><code>@dir ['global']</code></a></h4>
<p>Valid only for <code>string</code> properties. Indicates to the Godot editor that a string
should be a directory path.</p>
<ul>
<li><code>global</code>: If supplied, the path is not constrained to the current Godot
project.</li>
</ul>
<h4 id="multiline"><a class="header" href="#multiline"><code>@multiline</code></a></h4>
<p>Valid only for <code>string</code> properties. Indicates to the Godot editor that a string
should have a multiline editor.</p>
<h4 id="placeholdertext-text"><a class="header" href="#placeholdertext-text"><code>@placeholderText &lt;text&gt;</code></a></h4>
<p>Valid only for <code>string</code> properties. Indicates to the Godot editor that a certain
string should be displayed in the property’s text field if it is empty.</p>
<ul>
<li><code>text</code>: The placeholder text.</li>
</ul>
<h4 id="flags2d3drenderphysicsnavigationlayers"><a class="header" href="#flags2d3drenderphysicsnavigationlayers"><code>@flags{2D,3D}{Render,Physics,Navigation}Layers</code></a></h4>
<p>Valid only for <code>integer</code> properties. Indicate to the Godot editor that one of
the various layer editors should be shown in place of the default number editor.</p>
<h4 id="expeasing-attenuationpositiveonly"><a class="header" href="#expeasing-attenuationpositiveonly"><code>@expEasing ['attenuation'|'positiveOnly']</code></a></h4>
<p>Valid only for <code>number</code> properties. Indicates to the Godot editor that a easing
curve editor should be shown in place of the default number editor.</p>
<ul>
<li><code>attenuation</code>: Flips the curve horizontally.</li>
<li><code>positiveOnly</code>: Limit values to those greater than or equal to zero.</li>
</ul>
<h4 id="noalpha"><a class="header" href="#noalpha"><code>@noAlpha</code></a></h4>
<p>Valid only for <code>Color</code> properties. Indicates to the Godot editor that the color
should not have an editable alpha channel.</p>
<h3 id="signal"><a class="header" href="#signal"><code>@signal</code></a></h3>
<p>Indicates a property with the <code>Signal</code> or <a href="usage/class-registration/annotation-reference/../type-conversion.html#signalwithargsf"><code>SignalWithArgs&lt;F&gt;</code></a>
type should be registered as a signal.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="methods"><a class="header" href="#methods">Methods</a></h1>
<p>The following annotations should be attached to methods defined directly on
the table indicated by <code>@class</code>. For example:</p>
<pre><code class="language-lua">-- &lt;truncated&gt;

--- @registerMethod
function MyClass.TestMethod()
end
</code></pre>
<p>The following is not currently valid:</p>
<pre><code class="language-lua">-- &lt;truncated&gt;

-- Not recognized
--- @registerMethod
MyClass.TestMethod = function()
end
</code></pre>
<h2 id="registermethod"><a class="header" href="#registermethod"><code>@registerMethod</code></a></h2>
<p>Indicates a method should be accessible to Godot, registered based on its type
annotations.</p>
<p>If there are no type annotations, <code>Variant</code> is assumed for all arguments,
and the return value is <code>Variant</code> if the method returns anything.</p>
<h2 id="param-name-comment"><a class="header" href="#param-name-comment"><code>@param &lt;name&gt; [comment]</code></a></h2>
<p>Indicates a parameter’s usage. Not currently used by <code>godot-luau-script</code>.</p>
<ul>
<li><code>name</code>: The name of the parameter.</li>
<li><code>comment</code>: Comment describing the parameter.</li>
</ul>
<h2 id="defaultargs-array"><a class="header" href="#defaultargs-array"><code>@defaultArgs &lt;array&gt;</code></a></h2>
<p>Indicates a method’s default arguments when called from Godot.</p>
<ul>
<li><code>array</code>: The default values, in the format of an array compatible with Godot’s
<a href="https://docs.godotengine.org/en/stable/classes/class_@globalscope.html#class-globalscope-method-str-to-var"><code>str_to_var</code></a>.
The rightmost value corresponds to the rightmost argument.</li>
</ul>
<h2 id="return-comment"><a class="header" href="#return-comment"><code>@return [comment]</code></a></h2>
<p>The <code>@return</code> annotation documents a return value. It is not currently used by
<code>godot-luau-script</code>.</p>
<ul>
<li><code>comment</code>: Comment describing the return value.</li>
</ul>
<h2 id="flags-methodflags"><a class="header" href="#flags-methodflags"><code>@flags [...methodFlags]</code></a></h2>
<p>Overrides a method’s flags.</p>
<p>See the <a href="https://docs.godotengine.org/en/stable/classes/class_@globalscope.html#enum-globalscope-methodflags">Godot documentation</a>
for a list of flags and their meanings (omit <code>METHOD_FLAG_</code>).</p>
<ul>
<li><code>methodFlags</code>: The flag values.</li>
</ul>
<h2 id="rpc-anypeerauthority-unreliableunreliableorderedreliable-calllocal-channel"><a class="header" href="#rpc-anypeerauthority-unreliableunreliableorderedreliable-calllocal-channel"><code>@rpc ['anyPeer'|'authority'] ['unreliable'|'unreliableOrdered'|'reliable'] ['callLocal'] [channel]</code></a></h2>
<p>Registers a remote procedure call with Godot.</p>
<p>See the <a href="https://godotengine.org/article/multiplayer-changes-godot-4-0-report-2/">this Godot blog post</a> for details.</p>
<ul>
<li><code>anyPeer</code>: Allow the RPC to be called by any peer.</li>
<li><code>authority</code>: Only allow the RPC to be called by the multiplayer authority.</li>
<li><code>unreliable</code>: Transfer data unreliably without resending.</li>
<li><code>unreliableOrdered</code>: Transfer data unreliably without resending, but in the
correct order. Any older packets are dropped. This flag should not be used for
different types of messages on the same channel.</li>
<li><code>reliable</code>: Transfer data reliably; resend packets if they don’t arrive.</li>
<li><code>callLocal</code>: Indicate this method must also be called locally when the RPC is
sent.</li>
<li><code>channel</code>: Indicate the channel this RPC should use. Each channel handles
ordering of packets separately.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="assigns"><a class="header" href="#assigns">Assigns</a></h1>
<p>The following annotations should be attached to assignments to fields on the
table denoted by <code>@class</code>. For example:</p>
<pre><code class="language-lua">-- &lt;truncated&gt;

--- @registerConstant
MyClass.TEST_CONSTANT = 5
</code></pre>
<h2 id="registerconstant"><a class="header" href="#registerconstant"><code>@registerConstant</code></a></h2>
<p>Valid only for assignments with <code>Variant</code> values. Registers a constant value
with Godot.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="type-conversion"><a class="header" href="#type-conversion">Type Conversion</a></h1>
<p><code>godot-luau-script</code> does its best to determine the proper Godot type from Luau
type annotations. Here are a few things to note about this process:</p>
<h2 id="nullable--or-t--nil-types"><a class="header" href="#nullable--or-t--nil-types">Nullable (<code>?</code> or <code>T | nil</code>) types</a></h2>
<p>When annotating a method argument with a nullable type, the argument will be
registered to Godot as non-nullable (i.e. <code>number?</code> -&gt; <code>FLOAT</code>). If you want to
have the argument be optional on the Godot side, <a href="usage/class-registration/./annotation-reference/methods.html#defaultargs-array">register default arguments</a>.</p>
<p>When annotating anything else (properties, return types, etc.), using a nullable
type will cause the type to be registered with Godot as <code>Variant</code> unless the
type extends <code>Object</code>. This is because the only Godot type that accepts both
a value and <code>null</code> is <code>Variant</code>. If you encounter this, it’s recommended to
reimplement your logic such that using a nullable is not necessary.</p>
<h2 id="typedarrayt"><a class="header" href="#typedarrayt"><code>TypedArray&lt;T&gt;</code></a></h2>
<p>When used for methods and properties, <code>TypedArray&lt;T&gt;</code> will supply Godot with
the correct type for <code>Array</code> elements.</p>
<h2 id="nodepathconstrainedt"><a class="header" href="#nodepathconstrainedt"><code>NodePathConstrained&lt;T...&gt;</code></a></h2>
<p>When used for methods and properties, <code>NodePathConstrained&lt;T...&gt;</code> will tell
Godot to constrain valid <code>Node</code> types to the given types. Only supply types
which extend <code>Node</code>.</p>
<h2 id="signalwithargsf"><a class="header" href="#signalwithargsf"><code>SignalWithArgs&lt;F&gt;</code></a></h2>
<p>When used for signals, <code>SignalWithArgs&lt;F&gt;</code> will tell Godot the parameters of the
registered signal. The supplied type <code>F</code> should be a void (<code>-&gt; ()</code>) function
type with no generics and any number of arguments.</p>
<p>Argument names are optional. If not supplied, the default is <code>argN</code> where <code>N</code>
is the index of the argument starting from 1.</p>
<h2 id="other-potential-issues"><a class="header" href="#other-potential-issues">Other potential issues</a></h2>
<ul>
<li>Aliasing Godot types (e.g. <code>type D = Dictionary</code>) is not currently supported.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="virtual-methods"><a class="header" href="#virtual-methods">Virtual Methods</a></h1>
<p><code>godot-luau-script</code> supports the overriding of virtual methods.</p>
<h2 id="defined-in-an-object-class"><a class="header" href="#defined-in-an-object-class">Defined in an <code>Object</code> class</a></h2>
<p>If a virtual method such as <code>_process</code> or <code>_ready</code> is defined on an
<code>Object</code>-type class, you can override it by defining it in your class table and
registering it to Godot.</p>
<h2 id="built-into-godot-luau-script"><a class="header" href="#built-into-godot-luau-script">Built into <code>godot-luau-script</code></a></h2>
<p>This project comes with a number of built-in virtual methods, which can be
overridden just by defining them on your implementation table. They do not need
to be registered to Godot.</p>
<h3 id="function-_initself-"><a class="header" href="#function-_initself-"><code>function _Init(self): ()</code></a></h3>
<p>Called as soon as an <code>Object</code> with your script is instantiated.</p>
<p>At this time, you can initialize any values on the object or its underlying
table. Note that the virtual <code>_Ready</code> on <code>Node</code> may be equally or more
appropriate in many cases.</p>
<h3 id="function-_notificationself-what-number-"><a class="header" href="#function-_notificationself-what-number-"><code>function _Notification(self, what: number): ()</code></a></h3>
<p>Called whenever your object receives a notification. Refer to Godot
documentation to see what notifications you may receive.</p>
<h3 id="function-_tostringself-string"><a class="header" href="#function-_tostringself-string"><code>function _ToString(self): string</code></a></h3>
<p>Called whenever Godot wants to stringify your object, for example when printing
your object or calling <code>tostring</code>. It should return the string representation of
your object.</p>
<h3 id="custom-property-methods"><a class="header" href="#custom-property-methods">Custom property methods</a></h3>
<p>These methods should be used in combination to define custom properties for your
object, typically so they can show up in the editor. Keep in mind you must set
<a href="usage/class-registration/./annotation-reference/class-definition.html#tool"><code>@tool</code></a> on your class for these methods to run
in the editor.</p>
<h4 id="function-_getpropertylistself-gdproperty"><a class="header" href="#function-_getpropertylistself-gdproperty"><code>function _GetPropertyList(self): {GDProperty}</code></a></h4>
<p>Return a list of additional properties to be registered to Godot.</p>
<h4 id="function-_setself-name-string-value-variant-boolean"><a class="header" href="#function-_setself-name-string-value-variant-boolean"><code>function _Set(self, name: string, value: Variant): boolean</code></a></h4>
<p>Handle setting a value for a custom property. It should return <code>true</code> when it
set the value successfully, and <code>false</code> when it did not (or when the property
doesn’t exist).</p>
<h4 id="function-_getself-name-string-variant"><a class="header" href="#function-_getself-name-string-variant"><code>function _Get(self, name: string): Variant</code></a></h4>
<p>Handle getting a value for a custom property. It should return the value of the
property or <code>nil</code> if the property doesn’t exist.</p>
<h4 id="function-_propertycanrevertself-name-string-boolean"><a class="header" href="#function-_propertycanrevertself-name-string-boolean"><code>function _PropertyCanRevert(self, name: string): boolean</code></a></h4>
<p>Return <code>true</code> if the given property has a default value which the editor should
be able to revert to.</p>
<h4 id="function-_propertygetrevertself-name-string-variant"><a class="header" href="#function-_propertygetrevertself-name-string-variant"><code>function _PropertyGetRevert(self, name: string): Variant</code></a></h4>
<p>Overridden along with <code>_PropertyCanRevert</code>. It should return the default value
of the given property, or <code>nil</code> if it doesn’t exist.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-idiomatic-class"><a class="header" href="#the-idiomatic-class">The “Idiomatic” Class</a></h1>
<p>As this project is still in early stages, you shouldn’t consider this
syntax/interface stable yet.</p>
<p>The following class provides an example as to what is currently considered
“idiomatic” and type checkable:</p>
<pre><code class="language-lua">--!strict
--- @class MyClass
--- @extends Resource
local MyClass = {}

-- 'C' stands for class. The `gdclass` method gives access to the `.new
-- function.
local MyClassC = gdclass(MyClass)

-- These items registered will be accessible by indexing `MyClass`,
-- making them accessible to other scripts if they `require` this one.
MyClass.TestEnum = {
    ONE = 1,
    TWO = 2,
    THREE = 3,
}

--- @registerConstant
MyClass.TEST_CONSTANT = &quot;hello!&quot;

--- @classType MyClass
export type MyClass = Resource &amp; typeof(MyClassImpl) &amp; {
    --- @property
    --- @range 0.0 1.0 0.1
    --- @default 0.5
    testProperty: number,
}

--- Register a method to be accessible to Godot, based on its type annotations
--- @registerMethod
--- @param arg1 Comment 1
--- @param arg2 Comment 2
--- @return Something
function MyClass.TestMethodAST(self: MyClass, arg1: number, arg2: TypedArray&lt;Resource&gt;): Variant
    return 123
end

return MyClassC
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="godot-luau-script-api-reference"><a class="header" href="#godot-luau-script-api-reference"><code>godot-luau-script</code> API Reference</a></h1>
<p><code>godot-luau-script</code> provides its own library on top of bindings to Godot in
order to allow custom class creation and provide various other useful functions
(e.g. <code>wait</code> and <code>require</code>).</p>
<p>Currently, this library is defined and documented in
<code>definitions/luauLibTypes.part.d.lua</code>.</p>
<pre><code class="language-lua">---------------------
-- LUAGD_LIB TYPES --
---------------------

--- Constructs a new `StringName`.
--- @param str The string to use.
declare function SN(str: string): StringNameN

--- Constructs a new `NodePath`.
--- @param str The string to use.
declare function NP(str: string): NodePathN

-- TODO: constrain to Resource type?
--- Loads a resource. If the current script is not a core script, accessible
--- paths are restricted by SandboxService.
--- @param path The relative/absolute path to the resource from this script.
declare function load&lt;T&gt;(path: string): T?

--- Saves a resource. If the current script is not a core script, accessible
--- paths are restricted by SandboxService.
--- @param path The absolute path to save the resource to.
declare function save(resource: Resource, path: string, flags: ClassEnumResourceSaver_SaverFlags?)

--- Determines the Godot Variant type of a value, or `nil` if the value is not Variant-compatible.
--- @param value The value.
declare function gdtypeof(value: any): EnumVariantType?

--------------------
-- LUAU_LIB TYPES --
--------------------

--- A table type used to declare properties, method arguments, and return values.
export type GDProperty = {
    type: EnumVariantType?,
    name: string?,
    hint: EnumPropertyHint?,
    hintString: string?,
    usage: EnumPropertyUsageFlags?,
    className: string?,
}

--- A type returned from a script to register a custom class type.
declare class GDClass
    --- Constructs a new instance of the base object with this script.
    new: () -&gt; Object
end

--- Creates a new @see GDClass.
--- @param tbl The implementation table for any methods, constants, etc. Items in this table will be accessible by indexing this class definition.
declare function gdclass&lt;T&gt;(tbl: T): T &amp; GDClass

--- Yields the current thread and waits before resuming.
--- @param duration The duration to wait. If the engine is affected by a time factor, this duration will be affected by it.
declare function wait(duration: number): number

--- Yields the current thread and waits for the signal to be emitted before resuming.
--- @param signal The signal.
--- @param timeout The number of seconds to wait before timing out (default: 10 seconds).
--- @return The first return value is whether the signal was emitted (true) or timed out (false), and subsequent values are the arguments passed to the signal when it was emitted.
declare function wait_signal&lt;T...&gt;(signal: Signal, timeout: number?): (true, T...) | false

--- Gets a global constant (e.g. AutoLoad) which was defined in the Godot editor.
--- @param name The name of the global constant.
declare function gdglobal(name: StringNameLike): Variant

--------------
-- SERVICES --
--------------

export type EnumPCKScanError = number

declare class EnumPCKScanError_INTERNAL
    OK: EnumPCKScanError
    FILE_ERR: EnumPCKScanError
    MAGIC_NOT_FOUND_ERR: EnumPCKScanError
    PACK_VERSION_ERR: EnumPCKScanError
    GODOT_VERSION_ERR: EnumPCKScanError
    PACK_ENCRYPTED_ERR: EnumPCKScanError
    FILE_SCAN_ERR: EnumPCKScanError
end

export type EnumPCKFileScanError = number

declare class EnumPCKFileScanError_INTERNAL
    OK: EnumPCKFileScanError
    FILE_ENCRYPTED_ERR: EnumPCKFileScanError
    UNTRUSTED_GDSCRIPT_ERR: EnumPCKFileScanError
    UNTRUSTED_FILE_ERR: EnumPCKFileScanError
    ENDIANNESS_ERR: EnumPCKFileScanError
    RES_VERSION_ERR: EnumPCKFileScanError
    GODOT_VERSION_ERR: EnumPCKFileScanError
    SANDBOX_VIOLATION_ERR: EnumPCKFileScanError
end

export type EnumSandboxViolations = number

declare class EnumSandboxViolations_INTERNAL
    UNTRUSTED_EXT_SCRIPT_VIOLATION: EnumSandboxViolations
    RESOURCE_SANDBOX_VIOLATION: EnumSandboxViolations
    UNTRUSTED_INT_SCRIPT_VIOLATION: EnumSandboxViolations
end

--- Service handling script sandboxing
declare class SandboxService
    --- Returns whether a script is a core script.
    --- @param path The path to query.
    function IsCoreScript(self, path: string): boolean

    --- Initiates core script discovery from the project root. By default, any
    --- files present at this time will be considered core scripts.
    function DiscoverCoreScripts(self)

    --- Ignores a path from core script discovery. Any file paths starting with
    --- the given path will be ignored.
    --- @param path The path to ignore.
    function CoreScriptIgnore(self, path: string)

    --- Adds a script path as a core script.
    --- @param path The path to add.
    function CoreScriptAdd(self, path: string)

    --- Returns an array of all core scripts.
    function CoreScriptList(self): Array

    --- Adds access for non-core scripts to read or write resources to the given
    --- path and its subdirectories.
    --- @param path The path to add.
    function ResourceAddPathRW(self, path: string)

    --- Adds access for non-core scripts to read from the given path and its
    --- subdirectories.
    --- @param path The path to add.
    function ResourceAddPathRO(self, path: string)

    --- Removes access for non-core scripts to read or write from the given path
    --- and its subdirectories.
    --- @param path The path to remove.
    function ResourceRemovePath(self, path: string)

    --- Scans a PCK file and returns a report with details.
    --- @param path The path of the PCK to scan.
    function ScanPCK(self, path: string): Dictionary
end

--- Service handling debugging, GC diagnostics, and profiling
declare class DebugService
    --- Returns memory usage, in kibibytes (=1024 bytes), of each running VM.
    function GCCount(self): PackedFloat64Array

    --- Returns the current rate at which the garbage collector is attempting
    --- to collect on each VM, in KB/s, roughly corresponding to the rate at
    --- which memory usage is increasing.
    function GCStepSize(self): PackedInt32Array

    --- Executes code on the core VM with all permissions enabled.
    --- IMPORTANT: This method should not be used outside of debugging (i.e.
    --- core game logic should not depend on this functionality).
    --- @param src The source code to execute.
    --- @return An empty string if the call was successful, or the error message if any.
    function Exec(self, src: string): string
end

--- The main service through which all services are found.
declare LuauInterface: {
    SandboxService: SandboxService,
    DebugService: DebugService,
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="core-scripts-vms-and-permissions"><a class="header" href="#core-scripts-vms-and-permissions">“Core Scripts”, VMs, and Permissions</a></h1>
<p>These three concepts are essential to <code>godot-luau-script</code>’s sandboxing and
security.</p>
<h2 id="core-scripts"><a class="header" href="#core-scripts">“Core Scripts”</a></h2>
<p>Core scripts have special privileges such as being able to set their own
permissions. By default, no scripts are considered core scripts.</p>
<p>Scripts can be designated as core scripts through the <a href="usage/./luau-script-api.html"><code>SandboxService</code></a>,
typically using <a href="usage/./init-file.html"><code>init.lua</code></a>.</p>
<h2 id="vms"><a class="header" href="#vms">VMs</a></h2>
<p><code>godot-luau-script</code> currently runs 3 different Luau VMs for different use cases:</p>
<ol>
<li>The loading VM, which is used to load essential script information (e.g. a
list of methods and constant values).</li>
<li>The core VM, which is where all core scripts are executed.</li>
<li>The user VM, which is where all non-core scripts are executed.</li>
</ol>
<p>This provides a certain level of isolation and security in addition to thread
sandboxing.</p>
<h3 id="method-calls"><a class="header" href="#method-calls">Method calls</a></h3>
<p>Within the same VM, any script can call any other script’s methods, so long as
they are defined in the implementation table. Between VMs, scripts can only call
other scripts’ methods if they are registered to Godot. This gives a rough
notion of “public” and “private”.</p>
<h2 id="permissions"><a class="header" href="#permissions">Permissions</a></h2>
<p>As mentioned in the introduction, <code>godot-luau-script</code> was primarily created to
load untrusted scripts safely. This means that certain Godot APIs must be locked
behind special permissions, and that scripts will need to declare these
permissions to receive them.</p>
<p>The specific permission levels are listed <a href="usage/./class-registration.html">here</a>. As
noted above, only a core script can declare its own permissions.</p>
<p>Certain APIs receive special permissions, with <code>INTERNAL</code> being the default.
Permissions are set on the thread level, and are inherited to child threads.
If a thread ever tries to execute a method or other code of a permission level
it does not have, it will cause an error.</p>
<p>Note that only methods which are registered to Godot are executed on their
script’s thread. If any non-registered methods use protected APIs, classes with
Godot-registered methods that use them must declare the necessary permissions.</p>
<p>A comprehensive list of the permissions assigned to every Object class and
method can be seen at <code>bindgen/class_settings.toml</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modules"><a class="header" href="#modules">Modules</a></h1>
<p><code>godot-luau-script</code> supports non-class module scripts and the <code>require</code>
function.</p>
<h2 id="require"><a class="header" href="#require"><code>require</code></a></h2>
<p>The <code>require</code> function accepts a path relative to the current script, without
the <code>.lua</code> extension. It will load the file at the given path and return
whatever the file returned.</p>
<p>Requires are cached within the same Lua VM, and are reloaded when necessary (if
the script changes).</p>
<p>Please note that cyclic dependencies are not supported and may cause odd
behavior in the editor if encountered.</p>
<h2 id="module-scripts"><a class="header" href="#module-scripts">Module scripts</a></h2>
<p><code>require</code> can require a script (class) file, in which case it will return the
output of <code>gdclass</code> for the class.</p>
<p>However, you may want to create your own Lua types which don’t need to be
accessible to Godot. To do this in a dedicated file, create a file with the
extension <code>.mod.lua</code> which returns a function or a table.</p>
<p>Then, you will be able to require this file (being sure to include the <code>.mod</code>
but not the <code>.lua</code> in the require path).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-scheduler"><a class="header" href="#task-scheduler">Task Scheduler</a></h1>
<p><code>godot-luau-script</code> borrows the task scheduler (among other concepts) from
Roblox.</p>
<p>Currently, the task scheduler is only responsible for resuming yielded threads
and running the garbage collector.</p>
<p>It updates once every frame.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="initlua"><a class="header" href="#initlua">init.lua</a></h1>
<p>If <code>res://init.lua</code> exists, it is run with on the <a href="usage/./core-scripts-vms-permissions.html">core</a>
VM with all permissions enabled. Certain functionality, such as <code>require</code> and
<code>gdclass</code>, are disabled as <code>init.lua</code> is not considered a script file.</p>
<p>This file can be used to configure features which can or should be initialized
as soon as the extension is initialized, such as core script detection and
sandboxing settings.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="typechecking-and-autocomplete"><a class="header" href="#typechecking-and-autocomplete">Typechecking and Autocomplete</a></h1>
<p>Upon building, <code>godot-luau-script</code> will generate a single type definition file
for use by Luau’s analyzer.</p>
<p>Autocomplete and analysis in the Godot editor is not supported. As such, the
most viable setup is to use Visual Studio Code and the <a href="https://github.com/JohnnyMorganz/luau-lsp">luau-lsp</a>
extension.</p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>After installing VSCode and luau-lsp, you will need to do the
following setup:</p>
<ul>
<li>Set the preference <code>luau-lsp.require.mode</code> to <code>relativeToFile</code> to make
<code>require</code> relative to the current script.</li>
<li>Set the preference <code>luau-lsp.types.roblox</code> to <code>false</code> to disable Roblox types
being loaded by default.</li>
<li>Set the preference <code>luau-lsp.types.definitionFiles</code> to an array containing the
path to <code>definitions/luauScriptTypes.gen.d.lua</code>.</li>
<li>Set the FFlags <code>LuauRecursionLimit</code> and <code>LuauTarjanChildLimit</code> to something
higher than the defaults (e.g. 5000 and 20000 respectively). This can be done
through the <code>luau-lsp.fflags.override</code> preference.
<ul>
<li>This is necessary because the generated definition file is too large and
complex for Luau to parse by default.</li>
</ul>
</li>
</ul>
<p>After doing this (and reloading the workspace), you should get type checking and
autocomplete for all Godot and <code>godot-luau-script</code> types.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="known-issues"><a class="header" href="#known-issues">Known Issues</a></h1>
<p><code>godot-luau-script</code> and Godot’s GDExtension script language interface are both
relatively unstable. As such, you may experience issues when using them
together.</p>
<h2 id="error-_gdvirtual__get_language_call-required-virtual-method-scriptextension_get_language-must-be-overridden-before-calling"><a class="header" href="#error-_gdvirtual__get_language_call-required-virtual-method-scriptextension_get_language-must-be-overridden-before-calling">Error: <code>_gdvirtual__get_language_call: Required virtual method ScriptExtension::_get_language must be overridden before calling.</code></a></h2>
<p>This is likely an upstream issue with the initialization of GDExtension classes.
Scripts should run normally despite this error.</p>
<p>The issue is tracked <a href="https://github.com/godotengine/godot/issues/80275">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tests"><a class="header" href="#tests">Tests</a></h1>
<p><code>godot-luau-script</code> contains tests written using the
<a href="https://github.com/catchorg/Catch2">Catch2</a> framework. They can be built using
the <code>tests=yes</code> flag when running <code>scons</code>.</p>
<p>Tests can be run by running Godot in the <code>test_project</code> directory with the
<code>--luau-tests</code> flag. Then, Catch2 flags can be given after supplying a <code>--</code>
argument.</p>
<h2 id="note-for-windows-users"><a class="header" href="#note-for-windows-users">Note for Windows users</a></h2>
<p><code>godot-luau-script</code> uses a symbolic link to link <code>bin/</code> to <code>test_project/bin/</code>.
These do not work on Windows. If you want to run tests, you will need to copy
the folder (including built binaries) yourself.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debugging"><a class="header" href="#debugging">Debugging</a></h1>
<p>Assuming you built <code>godot-luau-script</code> with the <code>debug_symbols=yes</code> flag, you
will be able to debug the project by running Godot with a debugger attached.</p>
<p>In case you run into issues which the debugger cannot trace, they may be caused
by Godot engine code. You can debug engine code by cloning Godot and building it
with debug symbols as well. Be sure to <code>git checkout</code> the commit matching the
current supported version of Godot before building.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
